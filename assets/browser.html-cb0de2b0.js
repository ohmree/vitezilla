import{_ as l,W as r,X as k,$ as a,a0 as o,Z as n,a1 as s,E as c}from"./framework-72c45ff9.js";const d={},b=n("h1",{id:"deep-mock-of-browser",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#deep-mock-of-browser","aria-hidden":"true"},"#"),s(" Deep Mock of Browser")],-1),m=n("h2",{id:"problem",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#problem","aria-hidden":"true"},"#"),s(" Problem")],-1),v=n("p",null,[s("The "),n("code",null,"browser"),s(" object in webextensions is a deeply nested API, which requires you to call it like this:")],-1),f=n("div",{class:"language-typescript line-numbers-mode","data-ext":"ts"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(" browser "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'webextension-polyfill'"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"getActiveTabs"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"await"),s(" browser"),n("span",{class:"token punctuation"},"."),s("tabs"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"query"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" active"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"onBeforeRedirect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function-variable function"},"callback"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token keyword"},"void"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  browser`),n("span",{class:"token punctuation"},"."),s("webRequest"),n("span",{class:"token punctuation"},"."),s("onBeforeRedirect"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addListener"),n("span",{class:"token punctuation"},"("),s("callback"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
    urls`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"["),s(`
      `),n("span",{class:"token comment"},"// ..."),s(`
    `),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" browser"),n("span",{class:"token punctuation"},"."),s("webRequest"),n("span",{class:"token punctuation"},"."),s("onBeforeRedirect"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"removeListener"),n("span",{class:"token punctuation"},"("),s("callback"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),h=n("h2",{id:"solution",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#solution","aria-hidden":"true"},"#"),s(" Solution")],-1),w={href:"/core",target:"_blank",rel:"noopener noreferrer"},_=n("code",null,"mockBrowser",-1),y=n("div",{class:"language-typescript line-numbers-mode","data-ext":"ts"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" describe"),n("span",{class:"token punctuation"},","),s(" expect"),n("span",{class:"token punctuation"},","),s(" it"),n("span",{class:"token punctuation"},","),s(" vi "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'vitest'"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" mockBrowser "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@vitezilla/webextension'"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token function"},"describe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'WebExtension Helpers'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"describe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'getActiveTabs()'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token function"},"it"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'should return active tabs'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" tabs "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"{"),s(" id"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"1"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(" id"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"2"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
      mockBrowser`),n("span",{class:"token punctuation"},"."),s("tabs"),n("span",{class:"token punctuation"},"."),s("query"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" active"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"andResolve"),n("span",{class:"token punctuation"},"("),s("tabs"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

      `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"getActiveTabs"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toEqual"),n("span",{class:"token punctuation"},"("),s("tabs"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

  `),n("span",{class:"token function"},"describe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'onBeforeRedirect()'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token function"},"it"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'should register a listener and return a handle to remove the listener again'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" listener "),n("span",{class:"token operator"},"="),s(" vi"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"fn"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      mockBrowser`),n("span",{class:"token punctuation"},"."),s("webRequest"),n("span",{class:"token punctuation"},"."),s("onBeforeRedirect"),n("span",{class:"token punctuation"},"."),s("addListener"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("listener"),n("span",{class:"token punctuation"},","),s(" expect"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"anything"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

      `),n("span",{class:"token keyword"},"const"),s(" removeListener "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"onBeforeRedirect"),n("span",{class:"token punctuation"},"("),s("listener"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

      mockBrowser`),n("span",{class:"token punctuation"},"."),s("webRequest"),n("span",{class:"token punctuation"},"."),s("onBeforeRedirect"),n("span",{class:"token punctuation"},"."),s("removeListener"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("listener"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token function"},"removeListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),x=n("h2",{id:"more-details",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#more-details","aria-hidden":"true"},"#"),s(" More Details")],-1),g={href:"https://lusito.github.io/vitezilla/",target:"_blank",rel:"noopener noreferrer"};function B(R,q){const t=c("Tabs"),e=c("ExternalLinkIcon");return r(),k("div",null,[b,m,v,a(t,{id:"9",data:[{title:"my-webextension.ts"}]},{tab0:o(({title:p,value:u,isActive:i})=>[f]),_:1},8,["data"]),h,n("p",null,[s("By using the power of "),n("a",w,[s("Vitezilla"),a(e)]),s(", this project provides a "),_,s(" object you can import in your tests:")]),a(t,{id:"20",data:[{title:"my-webextension.spec.ts"}]},{tab0:o(({title:p,value:u,isActive:i})=>[y]),_:1},8,["data"]),x,n("p",null,[s("See the documentation of "),n("a",g,[s("vitezilla"),a(e)]),s(" to find out more about how you can use this API.")])])}const A=l(d,[["render",B],["__file","browser.html.vue"]]);export{A as default};
